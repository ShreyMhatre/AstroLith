<!DOCTYPE html>
<html>
<head>
    <title>Live Calibration</title>
</head>
<body>
<h1>Live Camera Calibration</h1>
<video id="video" playsinline autoplay muted width="640" height="480" style="display: none;"></video>
<canvas id="overlay" width="640" height="480"></canvas>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('overlay');
    const ctx = canvas.getContext('2d');

    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
        video.srcObject = stream;
        video.play();
    });

    setInterval(() => {
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = video.videoWidth;
            tempCanvas.height = video.videoHeight;
            tempCanvas.getContext('2d').drawImage(video, 0, 0);

            tempCanvas.toBlob(blob => {
                const formData = new FormData();
                formData.append('frame', blob, 'frame.jpg');
                fetch('/calibrate-frame', {
                    method: 'POST',
                    body: formData
                })
                    .then(res => res.blob())
                    .then(blob => {
                        const img = new Image();
                        img.onload = () => {
                            ctx.drawImage(img, 0, 0);
                        };
                        img.src = URL.createObjectURL(blob);
                    });
            }, 'image/jpeg');
        }
    }, 500);
</script>
</body>
</html>
